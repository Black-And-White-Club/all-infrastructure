# NATS Configuration for Local Development

# Basic Server Config
port: 4222
http_port: 8222

# JetStream Configuration
jetstream {
    store_dir: "/data"
}

# WebSocket Configuration (for PWA)
websocket {
    port: 4443
    no_tls: true
}

# Logging
debug: true
trace: false

# =============================================================================
# Auth Callout Configuration
# =============================================================================
# The backend service handles authentication via auth callout.
# When a client connects with a JWT, NATS calls out to the backend to validate.
#
# To enable:
# 1. Run: ./scripts/generate-nats-auth-keys.sh ./secrets
# 2. Replace ACCOUNT_PUBLIC_KEY_HERE with the generated account public key
# 3. Set AUTH_CALLOUT_ENABLED=true in backend environment
# =============================================================================

accounts {
    # Application account - all authenticated users connect here
    ACFZCYMXEOZSYNMEEGHGDOGN4PFYWLZEHIGHBBYPMQ3UFH4PZJ44QIAP {
        jetstream: enabled
        users: [
            # Auth callout service user (the backend)
            # This user handles auth requests and can pub/sub to system subjects
            {
                user: "auth-service"
                password: "auth-service-local-dev"
            }
        ]
    }

    # System account for auth callout
    SYS {
        users: [
            { user: "sys", password: "sys" }
        ]
    }
}

system_account: SYS

authorization {
    # Auth callout configuration (centralized mode)
    # When enabled, NATS will call out to the auth service for JWT validation
    # See: https://docs.nats.io/running-a-nats-service/configuration/securing_nats/auth_callout
    auth_callout {
        # The account that the auth service user belongs to
        account: ACFZCYMXEOZSYNMEEGHGDOGN4PFYWLZEHIGHBBYPMQ3UFH4PZJ44QIAP

        # The issuer public key - JWTs must be signed with this key's private key
        # For centralized auth callout, use the account key directly
        issuer: "ACFZCYMXEOZSYNMEEGHGDOGN4PFYWLZEHIGHBBYPMQ3UFH4PZJ44QIAP"

        # Users that can respond to auth callout requests
        auth_users: [ "auth-service" ]
    }
}

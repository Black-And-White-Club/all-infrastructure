apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
images:
  - name: frolf-bot-backend
    newName: us-ashburn-1.ocir.io/id2uwn5pyixh/frolf-bot/backend
    newTag: v1.0.171
  - name: us-ashburn-1.ocir.io/id2uwn5pyixh/frolf-bot/backend
    newTag: v1.0.171
patches:
  - target:
      kind: Deployment
      name: frolf-bot-backend
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env
        value:
          - name: DATABASE_URL
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: DATABASE_URL
          - name: NATS_URL
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: NATS_URL
          - name: ENV
            value: "production"
          - name: ENVIRONMENT
            value: "production"
          - name: LOG_LEVEL
            value: "info"
          - name: CONFIG_FILE
            value: ""
          - name: AUTO_MIGRATE
            value: "true"
          - name: METRICS_ADDRESS
            value: "alloy.observability.svc.cluster.local:4317"
          - name: METRICS_ENABLED
            value: "true"
          - name: LOKI_URL
            value: "http://loki.observability.svc.cluster.local:3100"
          - name: TEMPO_ENDPOINT
            value: "alloy.observability.svc.cluster.local:4317"
          - name: TEMPO_INSECURE
            value: "true"
          - name: OTLP_ENDPOINT
            value: "alloy.observability.svc.cluster.local:4317"
          - name: OTLP_TRANSPORT
            value: "grpc"
          - name: OTLP_LOGS_ENABLED
            value: "true"
          - name: PWA_BASE_URL
            value: "https://frolf-bot.duckdns.org"
          - name: JWT_SECRET
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: JWT_SECRET
          - name: JWT_ISSUER
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: JWT_ISSUER
          - name: JWT_AUDIENCE
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: JWT_AUDIENCE
          - name: AUTH_CALLOUT_ENABLED
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: AUTH_CALLOUT_ENABLED
          - name: AUTH_CALLOUT_SUBJECT
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: AUTH_CALLOUT_SUBJECT
          - name: AUTH_CALLOUT_ISSUER_NKEY
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: AUTH_CALLOUT_ISSUER_NKEY
          - name: AUTH_CALLOUT_SIGNING_NKEY
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: AUTH_CALLOUT_SIGNING_NKEY
          - name: DISCORD_OAUTH_CLIENT_ID
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: DISCORD_OAUTH_CLIENT_ID
          - name: DISCORD_OAUTH_CLIENT_SECRET
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: DISCORD_OAUTH_CLIENT_SECRET
          - name: DISCORD_OAUTH_REDIRECT_URL
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: DISCORD_OAUTH_REDIRECT_URL
          - name: GOOGLE_OAUTH_CLIENT_ID
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: GOOGLE_OAUTH_CLIENT_ID
          - name: GOOGLE_OAUTH_CLIENT_SECRET
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: GOOGLE_OAUTH_CLIENT_SECRET
          - name: GOOGLE_OAUTH_REDIRECT_URL
            valueFrom:
              secretKeyRef:
                name: backend-secrets
                key: GOOGLE_OAUTH_REDIRECT_URL

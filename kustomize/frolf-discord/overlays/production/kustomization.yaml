apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
images:
  - name: frolf-bot-discord
    newName: us-ashburn-1.ocir.io/id2uwn5pyixh/frolf-bot/discord
    digest: sha256:18e92888ca6dd8af59a83f3400e8c89b940413b6f90ae6fc419a56bb0a1968a7
  - name: us-ashburn-1.ocir.io/id2uwn5pyixh/frolf-bot/discord
    digest: sha256:e7e04cc85c5bfa2b49aa5b41f4c461505fa9aebc86bb72b09e375ae9b6e97830
patches:
  - target:
      kind: Deployment
      name: frolf-bot-discord
    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env
        value:
          - name: DISCORD_TOKEN
            valueFrom:
              secretKeyRef:
                name: discord-secrets
                key: token
          - name: DISCORD_APP_ID
            valueFrom:
              secretKeyRef:
                name: discord-secrets
                key: app-id
          - name: BACKEND_URL
            value: "http://frolf-bot-backend.frolf-bot.svc.cluster.local"
          - name: NATS_URL
            value: "nats://frolf-nats.frolf-bot.svc.cluster.local:4222"
          - name: LOG_LEVEL
            value: "info"
          - name: ENV
            value: "production"
          - name: ENVIRONMENT
            value: "production"
          - name: CONFIG_FILE
            value: ""
          - name: LOKI_URL
            value: "http://loki.observability.svc.cluster.local:3100"
          - name: METRICS_ADDRESS
            value: "alloy.observability.svc.cluster.local:4317"
          - name: METRICS_ENABLED
            value: "true"
          - name: OTEL_METRICS_EXPORTER
            value: "otlp"
          - name: OTEL_TRACES_EXPORTER
            value: "otlp"
          - name: OTEL_LOGS_EXPORTER
            value: "otlp"
          - name: OTEL_SDK_DISABLED
            value: "false"
          - name: OTEL_EXPORTER_OTLP_ENDPOINT
            value: "http://alloy.observability.svc.cluster.local:4317"
          - name: OTLP_ENDPOINT
            value: "alloy.observability.svc.cluster.local:4317"
          - name: OTLP_TRANSPORT
            value: "grpc"
          - name: TEMPO_ENDPOINT
            value: "alloy.observability.svc.cluster.local:4317"
          - name: TEMPO_INSECURE
            value: "true"
          - name: TEMPO_SAMPLE_RATE
            value: "0"
          - name: PPROF_ENABLED
            value: "true"
          - name: OTLP_LOGS_ENABLED
            value: "true"

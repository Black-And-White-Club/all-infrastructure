# NATS Values for nats-io/nats chart
#
# Auth Callout is configured with:
# - Issuer public key for JWT validation
# - Credentials injected from nats-secrets SealedSecret
#
config:
  cluster:
    enabled: false
  jetstream:
    enabled: true
    fileStore:
      enabled: true
      dir: /data
      pvc:
        enabled: true
        size: 10Gi
        storageClassName: "oci-block-storage"
  nats:
    port: 4222
  websocket:
    enabled: true
    port: 9222

  merge:
    accounts:
      ACFZCYMXEOZSYNMEEGHGDOGN4PFYWLZEHIGHBBYPMQ3UFH4PZJ44QIAP:
        jetstream: enabled
        users:
          - user: "auth-service"
            password: "<< $NATS_AUTH_SERVICE_PASSWORD >>"
          - user: "discord-bot"
            password: "<< $NATS_DISCORD_BOT_PASSWORD >>"
      SYS:
        users:
          - user: "sys"
            password: "<< $NATS_SYS_PASSWORD >>"

    system_account: SYS

    authorization:
      auth_callout:
        account: ACFZCYMXEOZSYNMEEGHGDOGN4PFYWLZEHIGHBBYPMQ3UFH4PZJ44QIAP
        issuer: "ACFZCYMXEOZSYNMEEGHGDOGN4PFYWLZEHIGHBBYPMQ3UFH4PZJ44QIAP"
        auth_users:
          - "auth-service"
          - "discord-bot"

natsBox:
  enabled: false

# Resource limits for the NATS pod
container:
  resources:
    requests:
      cpu: 50m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 1Gi
  env:
    NATS_AUTH_SERVICE_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: nats-secrets
          key: NATS_AUTH_SERVICE_PASSWORD
    NATS_SYS_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: nats-secrets
          key: NATS_SYS_PASSWORD
    NATS_DISCORD_BOT_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: nats-secrets
          key: NATS_DISCORD_BOT_PASSWORD

service:
  type: ClusterIP
  ports:
    websocket:
      port: 9222
      name: websocket

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/rewrite-target: /
  hosts:
    - host: frolf-bot.duckdns.org
      paths:
        - /nats
  tls:
    - secretName: frolf-bot-pwa-tls
      hosts:
        - frolf-bot.duckdns.org

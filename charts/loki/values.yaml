# Loki - Log aggregation and indexing
# Stores logs from all services and pods
# Query via Grafana with LogQL
# Stores chunks and index in OCI Object Storage

loki-distributed:
  loki:
    enabled: true
    config:
      auth_enabled: false
      chunk_store_config:
        chunk_cache_config:
          enable_fifocache: true
          default_validity: 1h
      limits_config:
        enforce_metric_name: false
        reject_old_samples: true
        reject_old_samples_max_age: 168h
      ingester:
        chunk_idle_period: 3m
        max_chunk_age: 1h
        chunk_retain_period: 1m
      # Storage backend - OCI Object Storage
      storage_config:
        s3:
          s3: s3://MIMIR_OCI_ACCESS_KEY:MIMIR_OCI_SECRET_KEY@id2uwn5pyixh.compat.objectstorage.us-phoenix-1.oraclecloud.com/loki-shared-bucket
          s3ForcePathStyle: true
          insecure: false

  minio:
    enabled: false

  # Ingester - receives logs from Alloy
  ingester:
    replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

  # Distributor - routes logs to ingesters
  distributor:
    replicas: 1
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

  # Query frontend - caches and parallelizes log queries
  queryFrontend:
    replicas: 1
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

  # Querier - handles log queries
  querier:
    replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

  # Gateway - reverse proxy for multi-tenancy
  gateway:
    enabled: true
    replicas: 1
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

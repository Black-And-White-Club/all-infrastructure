# Mimir - lightweight single-replica config for small workloads
# Disables HA/enterprise features and zone-aware replication for single-node deployments

mimir-distributed:
  global:
    dnsSDDomain: observability.svc.cluster.local

  # Disable built-in MinIO (using OCI Object Storage)
  minio:
    enabled: false

  # Disable built-in Kafka (not needed for small deployments)
  kafka:
    enabled: false

  mimir:
    structuredConfig:
      common:
        storage:
          backend: s3
          s3:
            bucket_name: mimir-shared-bucket
            endpoint: id2uwn5pyixh.compat.objectstorage.us-phoenix-1.oraclecloud.com
            access_key_id: ${MIMIR_OCI_ACCESS_KEY}
            secret_access_key: ${MIMIR_OCI_SECRET_KEY}
            insecure: false
            s3_force_path_style: true
      # Single-replica: no replication or zone awareness
      ingester:
        ring:
          replication_factor: 1
          zone_awareness_enabled: false
      store_gateway:
        sharding_ring:
          replication_factor: 1
          zone_awareness_enabled: false
      compactor:
        sharding_ring:
          replication_factor: 1

  # Disable Prometheus sub-chart
  prometheus:
    enabled: false

  ##############################################
  # DISABLED COMPONENTS (not needed for small setups)
  ##############################################
  alertmanager:
    enabled: false

  ruler:
    enabled: false

  overridesExporter:
    enabled: false

  gateway:
    enabled: false

  rolloutOperator:
    enabled: false

  queryScheduler:
    enabled: false

  ##############################################
  # INGESTER (single replica, no zones, Deployment instead of StatefulSet)
  ##############################################
  ingester:
    replicas: 1
    statefulSet:
      enabled: false
    persistence:
      enabled: false
    zoneAwareReplication:
      enabled: false
    resources:
      requests:
        cpu: 20m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 512Mi

  ##############################################
  # DISTRIBUTOR
  ##############################################
  distributor:
    replicas: 1
    resources:
      requests:
        cpu: 10m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 256Mi

  ##############################################
  # QUERY FRONTEND
  ##############################################
  queryFrontend:
    replicas: 1
    resources:
      requests:
        cpu: 15m
        memory: 64Mi
      limits:
        cpu: 150m
        memory: 256Mi

  ##############################################
  # QUERIER
  ##############################################
  querier:
    replicas: 1
    resources:
      requests:
        cpu: 25m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 512Mi

  ##############################################
  # COMPACTOR (single replica, no zones)
  ##############################################
  compactor:
    replicas: 1
    persistentVolume:
      enabled: false
    resources:
      requests:
        cpu: 10m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 256Mi

  ##############################################
  # STORE GATEWAY (single replica, no zones)
  ##############################################
  storeGateway:
    replicas: 1
    persistence:
      enabled: false
    zoneAwareReplication:
      enabled: false
    resources:
      requests:
        cpu: 15m
        memory: 64Mi
      limits:
        cpu: 150m
        memory: 256Mi

# Mimir - lightweight single-replica config for small workloads
# Disables HA/enterprise features and zone-aware replication for single-node deployments

global:
  extraEnvFrom:
    - secretRef:
        name: objectstore-creds

# Disable built-in MinIO (using OCI Object Storage)
minio:
  enabled: false

# Disable built-in Kafka (not needed for small deployments)
kafka:
  enabled: false

mimir:
  structuredConfig:
    # Disable multi-tenancy for single-tenant deployment
    multitenancy_enabled: false
    common:
      storage:
        backend: s3
        s3:
          bucket_name: mimir-shared-bucket
          endpoint: id2uwn5pyixh.compat.objectstorage.us-ashburn-1.oraclecloud.com
          region: us-ashburn-1
          access_key_id: ${MIMIR_OCI_ACCESS_KEY}
          secret_access_key: ${MIMIR_OCI_SECRET_KEY}
          insecure: false
    # Disable ingest storage (Kafka) - use direct ingestion instead
    ingest_storage:
      enabled: false
    # Single-replica: no replication or zone awareness
    # push_grpc_method_enabled must be true when ingest_storage is disabled
    ingester:
      push_grpc_method_enabled: true
      ring:
        replication_factor: 1
        zone_awareness_enabled: false
    store_gateway:
      sharding_ring:
        replication_factor: 1
        zone_awareness_enabled: false
    # Query-scheduler address for frontend and queriers
    frontend:
      scheduler_address: "mimir-query-scheduler-headless.observability.svc:9095"
    frontend_worker:
      scheduler_address: "mimir-query-scheduler-headless.observability.svc:9095"

##############################################
# DISABLED COMPONENTS (not needed for small setups)
##############################################
alertmanager:
  enabled: false

ruler:
  enabled: false

overrides_exporter:
  enabled: false

gateway:
  enabled: true
  resources:
    requests:
      cpu: 20m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 256Mi
  nginx:
    resolver: ""

rollout_operator:
  enabled: false

# Query scheduler is REQUIRED in Mimir 3.0 architecture
query_scheduler:
  enabled: true
  replicas: 1
  revisionHistoryLimit: 1
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 50m
      memory: 128Mi

##############################################
# INGESTER - single replica, no zones
##############################################
ingester:
  replicas: 1
  revisionHistoryLimit: 1
  zoneAwareReplication:
    enabled: false
  persistentVolume:
    enabled: false
  extraArgs:
    config.expand-env: "true"
  resources:
    requests:
      cpu: 20m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 512Mi

##############################################
# DISTRIBUTOR
##############################################
distributor:
  replicas: 1
  revisionHistoryLimit: 1
  extraArgs:
    config.expand-env: "true"
  resources:
    requests:
      cpu: 10m
      memory: 128Mi
    limits:
      cpu: 100m
      memory: 512Mi

##############################################
# QUERY FRONTEND
##############################################
query_frontend:
  replicas: 1
  revisionHistoryLimit: 1
  extraArgs:
    config.expand-env: "true"
  resources:
    requests:
      cpu: 15m
      memory: 64Mi
    limits:
      cpu: 150m
      memory: 256Mi

##############################################
# QUERIER
##############################################
querier:
  replicas: 1
  revisionHistoryLimit: 1
  extraArgs:
    config.expand-env: "true"
  resources:
    requests:
      cpu: 25m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 512Mi

##############################################
# COMPACTOR (single replica)
##############################################
compactor:
  replicas: 1
  revisionHistoryLimit: 1
  persistentVolume:
    enabled: false
  extraArgs:
    config.expand-env: "true"
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 256Mi

##############################################
# STORE GATEWAY (single replica, no zones)
##############################################
store_gateway:
  replicas: 1
  revisionHistoryLimit: 1
  zoneAwareReplication:
    enabled: false
  persistentVolume:
    enabled: false
  extraArgs:
    config.expand-env: "true"
  resources:
    requests:
      cpu: 15m
      memory: 64Mi
    limits:
      cpu: 150m
      memory: 256Mi
